# AI Guardian Lab - Dangerous Command Patterns
version: "1.2"

patterns:
  filesystem_destruction:
    - pattern: 'rm\s+(-[a-zA-Z]*r[a-zA-Z]*\s+)?-f\s+/'
      severity: critical
    - pattern: 'rm\s+--recursive\s+'
      severity: critical
    - pattern: 'rm\s+-rf\s+'
      severity: critical
    - pattern: 'mkfs\.'
      severity: critical
    - pattern: 'dd\s+if=/dev/(zero|random)\s+of=/dev/(sd|hd)'
      severity: critical
    - pattern: '>/dev/sd[a-z]'
      severity: critical
    - pattern: 'mv\s+/\s+'
      severity: critical

  fork_bombs:
    - pattern: ':\(\)\{\s*:\|:&\s*\};:'
      severity: critical

  # SEC-05: Privilege escalation â€” no ^ anchor so sudo is caught mid-command
  privilege_escalation:
    - pattern: 'sudo\s+su'
      severity: high
    - pattern: 'sudo\s+rm'
      severity: critical
    - pattern: 'sudo\s+cat\s+/etc/(shadow|passwd)'
      severity: high
    - pattern: 'sudo\s+chmod'
      severity: high
    - pattern: 'sudo\s+chown'
      severity: high
    - pattern: 'sudo\s+dd\s+'
      severity: critical
    - pattern: 'sudo\s+'
      severity: high
    - pattern: 'doas\s+'
      severity: high
    - pattern: 'pkexec\s+'
      severity: high
    - pattern: 'su\s+-c\s+'
      severity: high
    - pattern: 'chmod\s+[47][0-7][0-7]'
      severity: high
    - pattern: 'chmod\s+-R\s+777'
      severity: high
    - pattern: 'chown\s+root'
      severity: high

  # ReDoS-safe: replaced .* with .*? (non-greedy)
  remote_execution:
    - pattern: 'wget.*?\|\s*sh'
      severity: critical
    - pattern: 'curl.*?\|\s*bash'
      severity: critical
    - pattern: 'eval\s+\$\('
      severity: high

  dangerous_find:
    - pattern: 'find\s+/.*?-exec\s+rm'
      severity: high

  # SEC-03: Encoding bypass detection
  encoding_bypass:
    - pattern: 'base64\s+-d'
      severity: critical
    - pattern: 'xxd\s+-r'
      severity: critical
    - pattern: 'perl\s+-e'
      severity: high
    - pattern: 'python.*?-c'
      severity: high
    - pattern: 'openssl\s+enc\s+-d'
      severity: high

  # SEC-03: Subshell / variable expansion detection
  subshell_execution:
    - pattern: '\$\('
      severity: high
    - pattern: '`[^`]+`'
      severity: high

  # Exfiltration (ReDoS-safe: .*?)
  exfiltration:
    - pattern: 'nc\s+\d+\.\d+\.\d+\.\d+'
      severity: high
    - pattern: '\|\s*nc\s+'
      severity: high
    - pattern: 'curl\s+.*?-X\s+POST'
      severity: medium
    - pattern: 'wget\s+--post-data'
      severity: medium

  # Sensitive file reads
  sensitive_files:
    - pattern: 'cat\s+/etc/(shadow|passwd|sudoers)'
      severity: high
    - pattern: '/etc/shadow'
      severity: high
    - pattern: 'printenv'
      severity: medium
    - pattern: '\benv\b\s*$'
      severity: medium
